import{i as xe,r,j as e,I as w,f as u,V as S,C as x,b as J,c as Q,d as X,e as h,P as he,L as j,p as pe,a as k,u as p}from"./index-DmDksVhj.js";import{T as ue}from"./textarea-DCL4XO0K.js";import{T as je,a as fe,b as H,c as I}from"./tabs-D59TRr2A.js";import{D as T,a as C,b as D,c as E,d as ge}from"./dialog-zSSY6Pqa.js";import{B as L}from"./badge-fIrK5kD9.js";import{S as ye,a as Ne,b as be,c as ve,d as O}from"./select-BrD8s0Ad.js";import{B as we,G as Se,M as ke}from"./message-square-vli46aVE.js";import{S as M}from"./search-Dt4x7m3p.js";import{f as R}from"./format-B3XKS-z2.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=xe("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),ee={OPEN:"bg-sky-50 text-sky-700 border border-sky-100",IN_PROGRESS:"bg-amber-50 text-amber-700 border border-amber-100",RESOLVED:"bg-emerald-50 text-emerald-700 border border-emerald-100",CLOSED:"bg-slate-100 text-slate-700 border border-slate-200"},se={LOW:"bg-gray-500",MEDIUM:"bg-blue-500",HIGH:"bg-orange-500",URGENT:"bg-red-500"};function Re(){var K,Y;const[o,ae]=r.useState("help"),[P,te]=r.useState([]),[F,re]=r.useState([]),[U,le]=r.useState([]),[d,f]=r.useState(!0),[g,ie]=r.useState(""),[y,ce]=r.useState(""),[N,ne]=r.useState(""),[i,_]=r.useState(null),[c,V]=r.useState(null),[l,q]=r.useState(null),[oe,b]=r.useState(!1),[z,B]=r.useState(!1),[n,v]=r.useState({subject:"",description:"",priority:"MEDIUM"}),G=async()=>{var s,t;try{const a=new URLSearchParams;g.trim()&&a.set("search",g.trim()),y.trim()&&a.set("category",y.trim());const m=await k.get(`/admin/support/help-articles?${a}`);te(m.data.articles||[])}catch(a){p.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load help articles")}},A=async()=>{var s,t;try{const a=new URLSearchParams;N.trim()&&a.set("search",N.trim());const m=await k.get(`/admin/support/tutorials?${a}`);re(m.data.tutorials||[])}catch(a){p.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load tutorials")}},W=async()=>{var s,t;try{const a=await k.get("/admin/support/tickets");le(a.data.tickets||[])}catch(a){p.error(((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Failed to load tickets")}};r.useEffect(()=>{f(!0),o==="help"?G().catch(()=>{}).finally(()=>f(!1)):o==="tutorials"?A().catch(()=>{}).finally(()=>f(!1)):o==="tickets"&&W().catch(()=>{}).finally(()=>f(!1))},[o]),r.useEffect(()=>{if(o==="help"){const s=setTimeout(()=>G(),300);return()=>clearTimeout(s)}},[g,y]),r.useEffect(()=>{if(o==="tutorials"){const s=setTimeout(()=>A(),300);return()=>clearTimeout(s)}},[N]);const de=async s=>{var t,a,m,$;if(s==null||s.preventDefault(),!((t=n.subject)!=null&&t.trim())||!((a=n.description)!=null&&a.trim())){p.error("Subject and description are required");return}B(!0);try{await k.post("/admin/support/tickets",n),p.success("Support ticket created. We will get back to you soon."),b(!1),v({subject:"",description:"",priority:"MEDIUM"}),W()}catch(me){p.error((($=(m=me.response)==null?void 0:m.data)==null?void 0:$.message)||"Failed to create ticket")}finally{B(!1)}};return e.jsxs("div",{className:"space-y-6 min-h-[400px]",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Help & Support"}),e.jsx("p",{className:"text-muted-foreground",children:"Search help articles, tutorials, or raise a support ticket"})]}),e.jsxs(je,{value:o,onValueChange:ae,className:"w-full",children:[e.jsxs(fe,{className:"flex flex-wrap w-full sm:w-auto",children:[e.jsxs(H,{value:"help",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Help Center"]}),e.jsxs(H,{value:"tutorials",children:[e.jsx(Se,{className:"h-4 w-4 mr-2"}),"Tutorials"]}),e.jsxs(H,{value:"tickets",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"My Tickets"]})]}),e.jsxs(I,{value:"help",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Search by keyword...",value:g,onChange:s=>ie(s.target.value),className:"pl-9"})]}),e.jsx(u,{type:"button",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10","aria-label":"Search",children:e.jsx(M,{className:"h-4 w-4"})})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-3",children:e.jsx(w,{placeholder:"Filter by category",value:y,onChange:s=>ce(s.target.value),className:"w-full sm:w-48"})})]}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{size:"section"})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:P.map(s=>e.jsxs(x,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>_(s),children:[e.jsxs(J,{className:"pb-2",children:[e.jsx(Q,{className:"text-lg",children:s.title}),s.category&&e.jsx(X,{children:s.category})]}),e.jsx(h,{children:e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-3",children:s.content})})]},s._id))}),!d&&P.length===0&&e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center text-muted-foreground",children:"No help articles found. Try a different search or ask your admin to add articles in Support."})})]}),e.jsxs(I,{value:"tutorials",className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0 max-w-md",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(M,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(w,{placeholder:"Search tutorials...",value:N,onChange:s=>ne(s.target.value),className:"pl-9"})]}),e.jsx(u,{type:"button",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10","aria-label":"Search",children:e.jsx(M,{className:"h-4 w-4"})})]}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{size:"section"})}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:F.map(s=>e.jsxs(x,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>V(s),children:[e.jsx(J,{children:e.jsx(Q,{className:"text-lg",children:s.title})}),e.jsxs(h,{children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2",children:s.description}),s.youtubeLink&&e.jsxs("span",{className:"inline-flex items-center text-xs text-primary mt-2",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"})," Video available"]})]})]},s._id))}),!d&&F.length===0&&e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center text-muted-foreground",children:"No tutorials found. Try a different search or ask your admin to add tutorials in Support."})})]}),e.jsxs(I,{value:"tickets",className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs(u,{onClick:()=>b(!0),children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),"New Ticket"]})}),d?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(S,{size:"section"})}):e.jsx("div",{className:"space-y-3",children:U.map(s=>e.jsx(x,{className:"cursor-pointer hover:border-primary/50 transition-colors",onClick:()=>q(s),children:e.jsx(h,{className:"py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.subject}),e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-1",children:s.description})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:ee[s.status],children:s.status.replace("_"," ")}),e.jsx(L,{className:se[s.priority],children:s.priority}),e.jsx("span",{className:"text-xs text-muted-foreground",children:R(new Date(s.createdAt),"MMM d, yyyy")})]})]})})},s._id))}),!d&&U.length===0&&e.jsx(x,{children:e.jsx(h,{className:"py-12 text-center text-muted-foreground",children:'You have no support tickets yet. Click "New Ticket" to get help.'})})]})]}),e.jsx(T,{open:!!i,onOpenChange:s=>!s&&_(null),children:e.jsxs(C,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsx(E,{children:i==null?void 0:i.title}),(i==null?void 0:i.category)&&e.jsx(X,{children:i.category})]}),i&&e.jsx("div",{className:"prose prose-sm max-w-none whitespace-pre-wrap text-slate-700",children:i.content})]})}),e.jsx(T,{open:!!c,onOpenChange:s=>!s&&V(null),children:e.jsxs(C,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(D,{children:e.jsx(E,{children:c==null?void 0:c.title})}),c&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-muted-foreground whitespace-pre-wrap",children:c.description}),c.youtubeLink&&e.jsxs("a",{href:c.youtubeLink,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center text-primary hover:underline",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"})," Watch video"]}),((K=c.steps)==null?void 0:K.length)>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Steps"}),e.jsx("ol",{className:"list-decimal list-inside space-y-2",children:c.steps.sort((s,t)=>(s.order||0)-(t.order||0)).map((s,t)=>e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground ml-6",children:s.description})]},t))})]})]})]})}),e.jsx(T,{open:!!l,onOpenChange:s=>!s&&q(null),children:e.jsxs(C,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(D,{children:[e.jsxs(E,{children:["Ticket: ",l==null?void 0:l.subject]}),e.jsx("div",{className:"flex gap-2",children:l&&e.jsxs(e.Fragment,{children:[e.jsx(L,{className:ee[l.status],children:l.status.replace("_"," ")}),e.jsx(L,{className:se[l.priority],children:l.priority}),e.jsx("span",{className:"text-sm text-muted-foreground",children:R(new Date(l.createdAt),"PPp")})]})})]}),l&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-muted-foreground",children:"Description"}),e.jsx("p",{className:"mt-1 whitespace-pre-wrap",children:l.description})]}),((Y=l.replies)==null?void 0:Y.length)>0&&e.jsxs("div",{children:[e.jsx(j,{className:"text-muted-foreground",children:"Replies"}),e.jsx("div",{className:"mt-2 space-y-3 border-l-2 border-muted pl-4",children:l.replies.map((s,t)=>{var a;return e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"whitespace-pre-wrap",children:s.message}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[((a=s.repliedBy)==null?void 0:a.email)??"Support"," Â· ",s.repliedAt?R(new Date(s.repliedAt),"PPp"):""]})]},t)})})]})]})]})}),e.jsx(T,{open:oe,onOpenChange:b,children:e.jsxs(C,{children:[e.jsxs(D,{children:[e.jsx(E,{children:"Raise Support Ticket"}),e.jsx(ge,{children:"Describe your issue. Our team will respond as soon as possible."})]}),e.jsxs("form",{onSubmit:de,onKeyDown:pe,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(j,{htmlFor:"subject",children:"Subject *"}),e.jsx(w,{id:"subject",value:n.subject,onChange:s=>v({...n,subject:s.target.value}),placeholder:"Brief summary of your issue",required:!0})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"priority",children:"Priority"}),e.jsxs(ye,{value:n.priority,onValueChange:s=>v({...n,priority:s}),children:[e.jsx(Ne,{children:e.jsx(be,{})}),e.jsxs(ve,{children:[e.jsx(O,{value:"LOW",children:"Low"}),e.jsx(O,{value:"MEDIUM",children:"Medium"}),e.jsx(O,{value:"HIGH",children:"High"}),e.jsx(O,{value:"URGENT",children:"Urgent"})]})]})]}),e.jsxs("div",{children:[e.jsx(j,{htmlFor:"description",children:"Description *"}),e.jsx(ue,{id:"description",value:n.description,onChange:s=>v({...n,description:s.target.value}),placeholder:"Describe your issue in detail...",rows:5,required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(u,{type:"submit",disabled:z,children:[z?e.jsx(S,{size:"inline",className:"mr-2"}):null,"Submit Ticket"]})]})]})]})})]})}export{Re as default};
