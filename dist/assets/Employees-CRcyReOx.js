import{i as Q,n as X,o as Y,r as h,a as f,u as l,j as e,V as S,f as i,P as Z,C as ee,e as se,k as ae,K as re,I as o,p as A,L as c,g as z}from"./index-DqxcJu2F.js";import{D as L,a as O,b as q,c as I,d as M,f as R}from"./dialog-CjVt5OCo.js";import{P as te}from"./pen-square-BpQFywdQ.js";import{T as le}from"./trash-2-DELfmlqf.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=Q("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);function ce(){const k=X(),{user:m}=Y(s=>s.auth),[P,v]=h.useState([]),[K,F]=h.useState(!0),[$,j]=h.useState(!1),[H,y]=h.useState(!1),[b,w]=h.useState(null),[u,x]=h.useState(null),[N,C]=h.useState(!1),[a,d]=h.useState({name:"",email:"",password:"",phone:"",address:""});h.useEffect(()=>{if((m==null?void 0:m.role)!=="CAR_WASH_ADMIN"){k("/admin",{replace:!0});return}V()},[m==null?void 0:m.role,k]);const V=async()=>{var s,n;F(!0);try{const t=await f.get("/admin/employees");t.data.success?v(t.data.employees||[]):l.error("Failed to load employees")}catch(t){l.error(((n=(s=t.response)==null?void 0:s.data)==null?void 0:n.message)||"Failed to load employees")}finally{F(!1)}},g=()=>{d({name:"",email:"",password:"",phone:"",address:""}),x(null)},D=s=>{navigator.clipboard.writeText(s),l.success("Copied to clipboard")},B=async s=>{var n,t;if(s.preventDefault(),!a.name.trim()||!a.email.trim()){l.error("Name and email are required");return}C(!0);try{const r=await f.post("/admin/employees",{name:a.name.trim(),email:a.email.trim(),password:a.password||void 0,phone:a.phone.trim()||void 0,address:a.address.trim()||void 0});r.data.success?(l.success("Employee created"),x(r.data.temporaryPassword||null),v(p=>[...p,r.data.employee]),g(),j(!1)):l.error(r.data.message||"Failed to create")}catch(r){l.error(((t=(n=r.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to create employee")}finally{C(!1)}},W=s=>{w(s),d({name:s.name||"",email:s.email||"",password:"",phone:s.phone||"",address:s.address||""}),x(null),y(!0)},G=async s=>{var n,t;if(s.preventDefault(),!!b){C(!0);try{const r={name:a.name.trim(),email:a.email.trim(),phone:a.phone.trim()||void 0,address:a.address.trim()||void 0};a.password&&(r.password=a.password);const p=await f.put(`/admin/employees/${b._id}`,r);p.data.success?(l.success("Employee updated"),p.data.temporaryPassword&&x(p.data.temporaryPassword),v(E=>E.map(_=>_._id===b._id?p.data.employee:_)),y(!1),w(null),g()):l.error(p.data.message||"Failed to update")}catch(r){l.error(((t=(n=r.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to update")}finally{C(!1)}}},J=async s=>{var n,t;try{const r=await f.post(`/admin/employees/${s._id}/reset-password`);r.data.success&&(D(r.data.temporaryPassword),l.success("New password copied. Share it with the employee."))}catch(r){l.error(((t=(n=r.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to reset password")}},U=async s=>{var n,t;if(window.confirm("Delete this employee?"))try{const r=await f.delete(`/admin/employees/${s._id}`);r.data.success?(l.success("Employee deleted"),v(p=>p.filter(E=>E._id!==s._id))):l.error(r.data.message||"Failed to delete")}catch(r){l.error(((t=(n=r.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to delete")}};return(m==null?void 0:m.role)!=="CAR_WASH_ADMIN"?null:K?e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(S,{size:"section"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight",children:"Employees"}),e.jsx("p",{className:"text-muted-foreground text-sm",children:"Manage employee accounts. Employees can access Jobs and their performance dashboard."})]}),e.jsxs(i,{size:"default",onClick:()=>{g(),j(!0)},className:"gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),"Add Employee"]})]}),e.jsx(ee,{children:e.jsx(se,{className:"p-6",children:P.length===0?e.jsx("p",{className:"text-muted-foreground text-center py-8",children:"No employees yet. Add one to get started."}):e.jsx("div",{className:"space-y-3",children:P.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg hover:bg-muted/50 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"font-medium min-w-0",children:s.name||s.email}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>W(s),"aria-label":"Edit",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",onClick:()=>U(s),"aria-label":"Delete",children:e.jsx(le,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.email}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:"text-xs font-mono bg-muted px-2 py-0.5 rounded",children:s.employeeCode}),s.phone&&e.jsx("span",{className:"text-sm text-muted-foreground",children:s.phone})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-1",children:[e.jsx(ae,{to:`/admin/employees/${s._id}`,children:e.jsx(i,{variant:"outline",size:"sm",children:"Performance"})}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>J(s),title:"Generate new password and copy",className:"gap-1",children:[e.jsx(re,{className:"h-4 w-4"})," Reset password"]})]})]},s._id))})})}),e.jsx(L,{open:$,onOpenChange:s=>{j(s),s||(g(),x(null))},children:e.jsxs(O,{children:[e.jsxs(q,{children:[e.jsx(I,{children:"Add Employee"}),e.jsx(M,{children:"Employee code is auto-generated. Copy the password after creation."})]}),e.jsx(R,{children:u?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-lg p-3",children:"Copy the password now; it will not be shown again."}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{readOnly:!0,value:u,className:"font-mono"}),e.jsx(i,{variant:"outline",size:"icon",onClick:()=>D(u),children:e.jsx(T,{className:"h-4 w-4"})})]}),e.jsx(i,{onClick:()=>{x(null),j(!1)},children:"Done"})]}):e.jsxs("form",{onSubmit:B,onKeyDown:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Name *"}),e.jsx(o,{value:a.name,onChange:s=>d({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Login email *"}),e.jsx(o,{type:"email",value:a.email,onChange:s=>d({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Password (optional)"}),e.jsx(z,{value:a.password,onChange:s=>d({...a,password:s.target.value}),placeholder:"Min 6 chars"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Phone"}),e.jsx(o,{value:a.phone,onChange:s=>d({...a,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Address"}),e.jsx(o,{value:a.address,onChange:s=>d({...a,address:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsxs(i,{type:"submit",disabled:N,children:[N?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"inline",className:"mr-2"})," "]}):null,"Create"]})]})]})})]})}),e.jsx(L,{open:H,onOpenChange:s=>{y(s),s||(w(null),g(),x(null))},children:e.jsxs(O,{children:[e.jsxs(q,{children:[e.jsx(I,{children:"Edit Employee"}),e.jsx(M,{children:"Set a new password to reset it (copy and share)."})]}),e.jsx(R,{children:u?e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-amber-700 bg-amber-50 border border-amber-200 rounded-lg p-3",children:"New password:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{readOnly:!0,value:u,className:"font-mono"}),e.jsx(i,{variant:"outline",size:"icon",onClick:()=>D(u),children:e.jsx(T,{className:"h-4 w-4"})})]}),e.jsx(i,{onClick:()=>{x(null),y(!1),w(null)},children:"Done"})]}):e.jsxs("form",{onSubmit:G,onKeyDown:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Name *"}),e.jsx(o,{value:a.name,onChange:s=>d({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Login email *"}),e.jsx(o,{type:"email",value:a.email,onChange:s=>d({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(c,{children:"New password (optional)"}),e.jsx(z,{value:a.password,onChange:s=>d({...a,password:s.target.value}),placeholder:"Min 6 chars"})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Phone"}),e.jsx(o,{value:a.phone,onChange:s=>d({...a,phone:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Address"}),e.jsx(o,{value:a.address,onChange:s=>d({...a,address:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>y(!1),children:"Cancel"}),e.jsxs(i,{type:"submit",disabled:N,children:[N?e.jsxs(e.Fragment,{children:[e.jsx(S,{size:"inline",className:"mr-2"})," "]}):null,"Save"]})]})]})})]})})]})}export{ce as default};
