import{r as u,a as j,u as c,j as e,V as ue,f as m,P as G,p as $,L as i,I as o,g as me,C as b,e as S,b as he,c as xe,d as pe}from"./index-iCWoet6q.js";import{N as z}from"./number-input-B5x6ryCe.js";import{S as E,a as L,b as H,c as k,d as h}from"./select-D1YEjoH1.js";import{D as W,a as _,b as R,c as K,d as Z}from"./dialog-Tz2ogtQd.js";import{D as ge,a as je,M as Ne,b as ve,c as F}from"./dropdown-menu-LIl7V6Hi.js";import{B as fe}from"./badge-DRYRsU4i.js";import{S as Q}from"./search-b685rKvp.js";import{C as Ce,a as we}from"./chevron-right-CZ3lKImr.js";const A=12;function Pe(){const[J,X]=u.useState([]),[B,M]=u.useState(!0),[N,P]=u.useState(""),[T,D]=u.useState(""),[g,I]=u.useState("ALL"),[x,v]=u.useState(1),[p,Y]=u.useState({total:0,totalPages:0}),[ee,f]=u.useState(!1),[se,w]=u.useState(!1),[ae,q]=u.useState(null),[a,n]=u.useState({businessName:"",ownerName:"",phone:"",email:"",whatsappNumber:"",address:"",location:"",workingHoursStart:"09:00",workingHoursEnd:"18:00",carHandlingCapacity:"SINGLE",maxConcurrentJobs:1,defaultCurrency:"USD",defaultLanguage:"en",adminEmail:"",adminPassword:""});u.useEffect(()=>{C()},[N,g,x]);const C=async()=>{var s,d;M(!0);try{const t=new URLSearchParams;t.set("page",String(x)),t.set("limit",String(A)),N.trim()&&t.set("search",N.trim()),g!=="ALL"&&t.set("status",g);const r=await j.get(`/super-admin/businesses?${t.toString()}`);r.data.success?(X(r.data.businesses||[]),r.data.pagination&&Y({total:r.data.pagination.total,totalPages:r.data.pagination.totalPages})):c.error("Failed to load businesses")}catch(t){c.error(((d=(s=t.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to load businesses")}finally{M(!1)}},U=s=>{s==null||s.preventDefault(),P(T),v(1)},O=s=>{s<1||s>p.totalPages||v(s)},re=async s=>{var d,t,r;if(s.preventDefault(),a.carHandlingCapacity==="MULTIPLE"){const l=Number(a.maxConcurrentJobs);if(!l||l===0){c.error("Max concurrent jobs must be greater than zero");return}}try{const l={...a,maxConcurrentJobs:a.carHandlingCapacity==="SINGLE"?1:Number(a.maxConcurrentJobs)};l.adminEmail||delete l.adminEmail,l.adminPassword||delete l.adminPassword;const y=await j.post("/super-admin/businesses",l);if(y.data.success){const oe="Business created successfully!",ce=(d=y.data.adminUser)!=null&&d.password?`Admin Email: ${y.data.adminUser.email}
Password: ${y.data.adminUser.password}`:"Business created";c.success(oe,{description:ce,duration:1e4}),f(!1),V(),C()}else c.error("Failed to create business")}catch(l){c.error(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to create business")}},ne=async s=>{var d,t;if(s.preventDefault(),a.carHandlingCapacity==="MULTIPLE"){const r=Number(a.maxConcurrentJobs);if(!r||r===0){c.error("Max concurrent jobs must be greater than zero");return}}try{const r={...a,maxConcurrentJobs:a.carHandlingCapacity==="SINGLE"?1:Number(a.maxConcurrentJobs)};(await j.put(`/super-admin/businesses/${ae._id}`,r)).data.success?(c.success("Business updated successfully!"),w(!1),V(),C()):c.error("Failed to update business")}catch(r){c.error(((t=(d=r.response)==null?void 0:d.data)==null?void 0:t.message)||"Failed to update business")}},te=async(s,d)=>{var t,r;try{(await j.post(`/super-admin/businesses/${s}/suspend`,{status:d})).data.success?(c.success(`Business ${d==="ACTIVE"?"activated":"suspended"} successfully!`),C()):c.error("Failed to update business status")}catch(l){c.error(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update business status")}},ie=async s=>{var d,t;if(confirm("Are you sure you want to delete this business? This will remove the business and its admin user. This action cannot be undone."))try{(await j.delete(`/super-admin/businesses/${s}`)).data.success?(c.success("Business deleted successfully!"),C()):c.error("Failed to delete business")}catch(r){c.error(((t=(d=r.response)==null?void 0:d.data)==null?void 0:t.message)||"Failed to delete business")}},le=async s=>{var d,t;try{const r=await j.post(`/super-admin/businesses/${s}/reset-password`,{});r.data.success?c.success("Password reset successfully!",{description:r.data.newPassword?`New password: ${r.data.newPassword}`:"Password updated"}):c.error("Failed to reset password")}catch(r){c.error(((t=(d=r.response)==null?void 0:d.data)==null?void 0:t.message)||"Failed to reset password")}},V=()=>{n({businessName:"",ownerName:"",phone:"",email:"",whatsappNumber:"",address:"",location:"",workingHoursStart:"09:00",workingHoursEnd:"18:00",carHandlingCapacity:"SINGLE",maxConcurrentJobs:1,defaultCurrency:"USD",defaultLanguage:"en",adminEmail:"",adminPassword:""}),q(null)},de=s=>{q(s),n({businessName:s.businessName,ownerName:s.ownerName,phone:s.phone,email:s.email,whatsappNumber:s.whatsappNumber,address:s.address,location:s.location||"",workingHoursStart:s.workingHoursStart,workingHoursEnd:s.workingHoursEnd,carHandlingCapacity:s.carHandlingCapacity,maxConcurrentJobs:s.maxConcurrentJobs,defaultCurrency:s.defaultCurrency,defaultLanguage:s.defaultLanguage}),w(!0)};return B?e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(ue,{size:"section"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Car Washes"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage all car wash businesses"})]}),e.jsxs(m,{onClick:()=>f(!0),className:"gap-2",children:[e.jsx(G,{className:"h-4 w-4"}),"Add Business"]})]}),e.jsx(W,{open:ee,onOpenChange:f,children:e.jsxs(_,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(K,{children:"Onboard New Car Wash Business"}),e.jsx(Z,{children:"Complete the onboarding workflow to add a new car wash business"})]}),e.jsxs("form",{onSubmit:re,onKeyDown:$,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Business Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"businessName",children:"Business Name *"}),e.jsx(o,{id:"businessName",value:a.businessName,onChange:s=>n({...a,businessName:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"ownerName",children:"Owner Name *"}),e.jsx(o,{id:"ownerName",value:a.ownerName,onChange:s=>n({...a,ownerName:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Business Email *"}),e.jsx(o,{id:"email",type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Phone *"}),e.jsx(o,{id:"phone",value:a.phone,onChange:s=>n({...a,phone:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"whatsappNumber",children:"WhatsApp Number *"}),e.jsx(o,{id:"whatsappNumber",value:a.whatsappNumber,onChange:s=>n({...a,whatsappNumber:s.target.value}),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"address",children:"Address *"}),e.jsx(o,{id:"address",value:a.address,onChange:s=>n({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"location",children:"Location (Optional)"}),e.jsx(o,{id:"location",value:a.location,onChange:s=>n({...a,location:s.target.value}),placeholder:"City, State, Country"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"workingHoursStart",children:"Working Hours Start *"}),e.jsx(o,{id:"workingHoursStart",type:"time",value:a.workingHoursStart,onChange:s=>n({...a,workingHoursStart:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"workingHoursEnd",children:"Working Hours End *"}),e.jsx(o,{id:"workingHoursEnd",type:"time",value:a.workingHoursEnd,onChange:s=>n({...a,workingHoursEnd:s.target.value}),required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Operational Settings"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"carHandlingCapacity",children:"Car Handling Capacity *"}),e.jsxs(E,{value:a.carHandlingCapacity,onValueChange:s=>n({...a,carHandlingCapacity:s,maxConcurrentJobs:s==="SINGLE"?1:a.maxConcurrentJobs}),children:[e.jsx(L,{children:e.jsx(H,{})}),e.jsxs(k,{children:[e.jsx(h,{value:"SINGLE",children:"Single Car"}),e.jsx(h,{value:"MULTIPLE",children:"Multiple Cars"})]})]})]}),a.carHandlingCapacity==="MULTIPLE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"maxConcurrentJobs",children:"Max Concurrent Jobs *"}),e.jsx(z,{id:"maxConcurrentJobs",value:a.maxConcurrentJobs,onChange:s=>n({...a,maxConcurrentJobs:s}),required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Admin User Credentials"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Leave blank to use business email and auto-generate password"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"adminEmail",children:"Admin Email (Optional)"}),e.jsx(o,{id:"adminEmail",type:"email",value:a.adminEmail,onChange:s=>n({...a,adminEmail:s.target.value}),placeholder:"Leave blank to use business email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"adminPassword",children:"Admin Password (Optional)"}),e.jsx(me,{id:"adminPassword",value:a.adminPassword,onChange:s=>n({...a,adminPassword:s.target.value}),placeholder:"Leave blank to auto-generate",minLength:6})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(m,{type:"submit",children:"Onboard Business"})]})]})]})}),e.jsx(b,{children:e.jsx(S,{className:"p-6",children:e.jsxs("form",{onSubmit:U,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(o,{placeholder:"Search by name, owner, email...",value:T,onChange:s=>D(s.target.value),onKeyDown:s=>s.key==="Enter"&&U(s),className:"pl-9"})]}),e.jsx(m,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(E,{value:g,onValueChange:s=>{I(s),v(1)},children:[e.jsx(L,{className:"w-[160px]",children:e.jsx(H,{placeholder:"Status"})}),e.jsxs(k,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"ACTIVE",children:"Active"}),e.jsx(h,{value:"SUSPENDED",children:"Suspended"}),e.jsx(h,{value:"INACTIVE",children:"Inactive"})]})]}),(N||g!=="ALL")&&e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>{P(""),D(""),I("ALL"),v(1)},children:"Clear"})]})]})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[J.map(s=>{var d,t,r;return e.jsxs(b,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{className:"text-lg",children:s.businessName}),e.jsx(pe,{children:s.ownerName})]}),e.jsxs(ge,{children:[e.jsx(je,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsx(F,{onClick:l=>{l.preventDefault(),de(s)},children:"Edit"}),e.jsx(F,{onClick:l=>{l.preventDefault(),le(s._id)},children:"Reset Password"}),e.jsx(F,{onClick:l=>{l.preventDefault(),te(s._id,s.status==="ACTIVE"?"SUSPENDED":"ACTIVE")},children:s.status==="ACTIVE"?"Suspend":"Activate"}),e.jsx(F,{onClick:l=>{l.preventDefault(),ie(s._id)},className:"text-destructive focus:text-destructive",children:"Delete"})]})]})]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status"}),e.jsx(fe,{variant:s.status==="ACTIVE"?"default":"secondary",children:s.status})]}),((d=s.plan)==null?void 0:d.planId)&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan"}),e.jsx("span",{className:"font-medium",children:s.plan.planId.name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Jobs"}),e.jsx("span",{className:"font-medium",children:((t=s.stats)==null?void 0:t.jobs)||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Customers"}),e.jsx("span",{className:"font-medium",children:((r=s.stats)==null?void 0:r.customers)||0})]})]})})]},s._id)}),J.length===0&&!B&&e.jsx(b,{className:"col-span-full",children:e.jsxs(S,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"No businesses found"}),N||g!=="ALL"?e.jsx(m,{variant:"outline",className:"mt-4",onClick:()=>{P(""),D(""),I("ALL"),v(1)},children:"Clear filters"}):e.jsxs(m,{className:"mt-4",onClick:()=>f(!0),children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Create First Business"]})]})})]}),p.totalPages>1&&e.jsx(b,{children:e.jsx(S,{className:"py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min((x-1)*A+1,p.total),"â€“",Math.min(x*A,p.total)," of ",p.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>O(x-1),disabled:x<=1,children:[e.jsx(Ce,{className:"h-4 w-4"}),"Previous"]}),e.jsxs("span",{className:"text-sm",children:["Page ",x," of ",p.totalPages]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>O(x+1),disabled:x>=p.totalPages,children:["Next",e.jsx(we,{className:"h-4 w-4"})]})]})]})})}),e.jsx(W,{open:se,onOpenChange:w,children:e.jsxs(_,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(K,{children:"Edit Business"}),e.jsx(Z,{children:"Update all business information"})]}),e.jsxs("form",{onSubmit:ne,onKeyDown:$,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-businessName",children:"Business Name *"}),e.jsx(o,{id:"edit-businessName",value:a.businessName,onChange:s=>n({...a,businessName:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-ownerName",children:"Owner Name *"}),e.jsx(o,{id:"edit-ownerName",value:a.ownerName,onChange:s=>n({...a,ownerName:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-email",children:"Business Email *"}),e.jsx(o,{id:"edit-email",type:"email",value:a.email,onChange:s=>n({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(o,{id:"edit-phone",value:a.phone,onChange:s=>n({...a,phone:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-whatsappNumber",children:"WhatsApp Number *"}),e.jsx(o,{id:"edit-whatsappNumber",value:a.whatsappNumber,onChange:s=>n({...a,whatsappNumber:s.target.value}),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-address",children:"Address *"}),e.jsx(o,{id:"edit-address",value:a.address,onChange:s=>n({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-location",children:"Location (Optional)"}),e.jsx(o,{id:"edit-location",value:a.location,onChange:s=>n({...a,location:s.target.value}),placeholder:"City, State, Country"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-workingHoursStart",children:"Working Hours Start *"}),e.jsx(o,{id:"edit-workingHoursStart",type:"time",value:a.workingHoursStart,onChange:s=>n({...a,workingHoursStart:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-workingHoursEnd",children:"Working Hours End *"}),e.jsx(o,{id:"edit-workingHoursEnd",type:"time",value:a.workingHoursEnd,onChange:s=>n({...a,workingHoursEnd:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-carHandlingCapacity",children:"Car Handling Capacity *"}),e.jsxs(E,{value:a.carHandlingCapacity,onValueChange:s=>n({...a,carHandlingCapacity:s,maxConcurrentJobs:s==="SINGLE"?1:a.maxConcurrentJobs}),children:[e.jsx(L,{children:e.jsx(H,{})}),e.jsxs(k,{children:[e.jsx(h,{value:"SINGLE",children:"Single Car"}),e.jsx(h,{value:"MULTIPLE",children:"Multiple Cars"})]})]})]}),a.carHandlingCapacity==="MULTIPLE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-maxConcurrentJobs",children:"Max Concurrent Jobs *"}),e.jsx(z,{id:"edit-maxConcurrentJobs",value:a.maxConcurrentJobs,onChange:s=>n({...a,maxConcurrentJobs:s}),required:!0})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-defaultLanguage",children:"Default Language"}),e.jsxs(E,{value:a.defaultLanguage,onValueChange:s=>n({...a,defaultLanguage:s}),children:[e.jsx(L,{children:e.jsx(H,{})}),e.jsxs(k,{children:[e.jsx(h,{value:"en",children:"English"}),e.jsx(h,{value:"es",children:"Spanish"}),e.jsx(h,{value:"ar",children:"Arabic"})]})]})]})}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(m,{type:"submit",children:"Update Business"})]})]})]})})]})}export{Pe as default};
