import{i as ee,r as l,a as p,u as h,j as e,V as _,C as q,b as k,c as A,d as Y,e as v,f as D,p as se,L as te}from"./index-DbUb8UN5.js";import{T as ae}from"./textarea-D3CWpPRq.js";import{D as ne,a as re,b as ie,c as le,d as de,f as ce}from"./dialog-BiDWtJbd.js";import"./badge-BYh-yafP.js";import{S as oe}from"./StatusBadge-ChIJ-bKC.js";import{f as z}from"./currencyUtils-CJd_f-r_.js";import{t as H,d as ue,f as T}from"./format-B3XKS-z2.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=ee("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);function xe(s,d){const i=H(s),o=H(d),u=B(i,o),m=Math.abs(ue(i,o));i.setDate(i.getDate()-u*m);const f=+(B(i,o)===-u),x=u*(m-f);return x===0?0:x}function B(s,d){const i=s.getFullYear()-d.getFullYear()||s.getMonth()-d.getMonth()||s.getDate()-d.getDate()||s.getHours()-d.getHours()||s.getMinutes()-d.getMinutes()||s.getSeconds()-d.getSeconds()||s.getMilliseconds()-d.getMilliseconds();return i<0?-1:i>0?1:i}function Ne(){var I;const[s,d]=l.useState(null),[i,o]=l.useState([]),[u,m]=l.useState(null),[f,x]=l.useState(!0),[S,O]=l.useState("USD"),[V,L]=l.useState(!0),[W,j]=l.useState(!1),[P,C]=l.useState(""),[w,b]=l.useState(""),[M,R]=l.useState(!1);l.useEffect(()=>{G()},[]),l.useEffect(()=>{p.get("/admin/settings").then(t=>{var n,c;(n=t.data)!=null&&n.success&&((c=t.data.settings)!=null&&c.currency)&&O(t.data.settings.currency)}).catch(()=>{})},[]);const G=async()=>{var t,n,c;try{const[r,y]=await Promise.all([p.get("/admin/my-subscription"),p.get("/admin/available-plans")]);r.data.success&&(d(r.data.subscription),x(r.data.canRequestUpgrade!==!1)),y.data.success&&o(y.data.plans||[]);const U=await p.get("/admin/upgrade-requests").catch(()=>({}));if((t=U.data)!=null&&t.requests){const Q=U.data.requests.find($=>$.status==="PENDING");m(Q||null)}}catch(r){h.error(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Failed to load plan data")}finally{L(!1)}},K=async t=>{var n,c;if(t.preventDefault(),!P){h.error("Select a plan");return}R(!0);try{const r=await p.post("/admin/upgrade-request",{requestedPlanId:P,message:w||void 0});r.data.success?(h.success("Upgrade request submitted. Pending admin approval."),j(!1),C(""),b(""),m(r.data.request),x(!1)):h.error(r.data.message||"Failed to submit request")}catch(r){h.error(((c=(n=r.response)==null?void 0:n.data)==null?void 0:c.message)||"Failed to submit request")}finally{R(!1)}},X=t=>{C(t),b(""),j(!0)};if(V)return e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(_,{size:"section"})});const a=s==null?void 0:s.planId,E=s!=null&&s.startDate?new Date(s.startDate):null,g=s!=null&&s.expiryDate?new Date(s.expiryDate):null,Z=g&&g>new Date?xe(g,new Date):0,F=(s==null?void 0:s.status)==="EXPIRED",N=!!u,J=!f||N;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-800",children:"My Plan"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-0.5",children:"View your current subscription and request plan upgrades. Admin approval required."})]}),e.jsxs(q,{children:[e.jsxs(k,{children:[e.jsx(A,{children:"Current Plan"}),e.jsx(Y,{children:"Your active subscription details"})]}),e.jsx(v,{className:"space-y-4",children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xl font-semibold text-slate-800",children:(a==null?void 0:a.name)||"—"}),e.jsx(oe,{status:s.status,positive:!F})]}),(a==null?void 0:a.price)!=null&&e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price:"})," ",e.jsx("span",{className:"font-medium",children:z(a.price,S)})]}),e.jsxs("div",{className:"grid gap-2 text-sm",children:[E&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Start date:"})," ",T(E,"PPP")]}),g&&e.jsxs("p",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Expiry date:"})," ",T(g,"PPP"),!F&&e.jsxs("span",{className:"ml-2 text-muted-foreground",children:["(",Z," days remaining)"]})]})]}),((I=a==null?void 0:a.features)==null?void 0:I.length)>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:"Features"}),e.jsx("ul",{className:"list-disc list-inside text-sm space-y-0.5",children:a.features.map((t,n)=>e.jsx("li",{children:t},n))})]}),N&&e.jsxs("div",{className:"rounded-lg bg-amber-50 border border-amber-100 p-3 text-sm text-amber-800",children:[e.jsx("strong",{children:"Pending upgrade request"})," — Waiting for admin approval. You cannot submit another request until this is processed."]})]}):e.jsx("p",{className:"text-muted-foreground",children:"No subscription found. Contact platform admin."})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-medium text-slate-800 mb-1",children:"Available Plans"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Request an upgrade. Admin approval required — no online payment."}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:i.map(t=>{var c;const n=(a==null?void 0:a._id)===t._id;return e.jsxs(q,{className:"transition-shadow duration-150",children:[e.jsxs(k,{children:[e.jsx(A,{className:"text-lg text-slate-800",children:t.name}),e.jsxs(Y,{children:[t.validityDays," days validity · ",z(t.price??0,S)]})]}),e.jsxs(v,{className:"space-y-3",children:[t.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description}),((c=t.features)==null?void 0:c.length)>0&&e.jsx("ul",{className:"text-sm list-disc list-inside space-y-0.5",children:t.features.slice(0,5).map((r,y)=>e.jsx("li",{children:r},y))}),e.jsxs(D,{size:"sm",variant:n?"secondary":"default",disabled:n||J,onClick:()=>X(t._id),className:"gap-1",children:[e.jsx(me,{className:"h-4 w-4"}),n?"Current plan":N?"Request pending":f?"Request upgrade":"Upgrade not available"]})]})]},t._id)})}),i.length===0&&e.jsx(q,{children:e.jsx(v,{className:"p-8 text-center text-muted-foreground",children:"No other plans available."})})]}),e.jsx(ne,{open:W,onOpenChange:j,children:e.jsxs(re,{children:[e.jsxs(ie,{children:[e.jsx(le,{children:"Request plan upgrade"}),e.jsx(de,{children:"Your request will be reviewed by the admin. No payment is processed — admin approval required."})]}),e.jsx(ce,{children:e.jsxs("form",{onSubmit:K,onKeyDown:se,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(te,{children:"Message to admin (optional)"}),e.jsx(ae,{value:w,onChange:t=>b(t.target.value),placeholder:"e.g. We need more capacity for the upcoming season",rows:3})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>j(!1),children:"Cancel"}),e.jsx(D,{type:"submit",disabled:M,children:M?e.jsxs(e.Fragment,{children:[e.jsx(_,{size:"inline",className:"mr-2"})," Submitting..."]}):"Submit request"})]})]})})]})})]})}export{Ne as default};
