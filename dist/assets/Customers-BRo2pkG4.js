import{r as c,a as N,u as o,j as e,V as Q,f as i,P as X,p as L,L as m,I as d,C as v,e as y,b as Y,c as ee,M as se}from"./index-DmDksVhj.js";import{D as O,e as ae,a as T,b as I,c as _,d as U,f as $}from"./dialog-zSSY6Pqa.js";import{S as K}from"./search-Dt4x7m3p.js";import{P as te}from"./pen-square-BelVKB65.js";import{T as re}from"./trash-2-CF2VZWVb.js";import{C as ne,a as ie}from"./chevron-right-Cytcf5BV.js";const D=12;function le(u){return!u||typeof u!="string"?"":u.replace(/\D/g,"")}function pe(){const[u,F]=c.useState([]),[P,A]=c.useState(!0),[p,C]=c.useState(""),[E,b]=c.useState(""),[h,j]=c.useState(1),[x,M]=c.useState({total:0,totalPages:0}),[R,w]=c.useState(!1),[B,g]=c.useState(!1),[k,S]=c.useState(null),[a,l]=c.useState({name:"",phone:"",whatsappNumber:"",email:"",address:"",notes:""});c.useEffect(()=>{f()},[p,h]);const f=async()=>{var s,r;A(!0);try{const t=new URLSearchParams;t.set("page",String(h)),t.set("limit",String(D)),p.trim()&&t.set("search",p.trim());const n=await N.get(`/admin/customers?${t.toString()}`);n.data.success?(F(n.data.customers||[]),n.data.pagination&&M({total:n.data.pagination.total,totalPages:n.data.pagination.totalPages})):o.error("Failed to load customers")}catch(t){o.error(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to load customers")}finally{A(!1)}},z=s=>{s==null||s.preventDefault(),C(E),j(1)},q=s=>{s<1||s>x.totalPages||j(s)},H=s=>{const r=le(s.whatsappNumber||s.phone);if(!r){o.error("No WhatsApp number for this customer");return}window.open(`https://wa.me/${r}`,"_blank","noopener,noreferrer")},V=async s=>{var r,t;s.preventDefault();try{(await N.post("/admin/customers",a)).data.success?(o.success("Customer created successfully!"),w(!1),W(),f()):o.error("Failed to create customer")}catch(n){o.error(((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to create customer")}},G=async s=>{var r,t;if(s.preventDefault(),!!k)try{(await N.put(`/admin/customers/${k._id}`,a)).data.success?(o.success("Customer updated successfully!"),g(!1),S(null),W(),f()):o.error("Failed to update customer")}catch(n){o.error(((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to update customer")}},J=s=>{S(s),l({name:s.name,phone:s.phone,whatsappNumber:s.whatsappNumber||"",email:s.email||"",address:s.address||"",notes:s.notes||""}),g(!0)},Z=async s=>{var r,t;if(confirm("Are you sure you want to delete this customer?"))try{(await N.delete(`/admin/customers/${s}`)).data.success?(o.success("Customer deleted successfully!"),f()):o.error("Failed to delete customer")}catch(n){o.error(((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to delete customer")}},W=()=>{l({name:"",phone:"",whatsappNumber:"",email:"",address:"",notes:""})};return P?e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(Q,{size:"section"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Customers"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your customers"})]}),e.jsxs(O,{open:R,onOpenChange:w,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(i,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Add Customer"]})}),e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(_,{children:"Create New Customer"}),e.jsx(U,{children:"Add a new customer to your system"})]}),e.jsx($,{children:e.jsxs("form",{onSubmit:V,onKeyDown:L,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"name",children:"Name *"}),e.jsx(d,{id:"name",value:a.name,onChange:s=>l({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"phone",children:"Phone *"}),e.jsx(d,{id:"phone",value:a.phone,onChange:s=>l({...a,phone:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"whatsappNumber",children:"WhatsApp Number *"}),e.jsx(d,{id:"whatsappNumber",value:a.whatsappNumber,onChange:s=>l({...a,whatsappNumber:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"email",children:"Email"}),e.jsx(d,{id:"email",type:"email",value:a.email,onChange:s=>l({...a,email:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>w(!1),children:"Cancel"}),e.jsx(i,{type:"submit",children:"Create Customer"})]})]})})]})]}),e.jsx(O,{open:B,onOpenChange:g,children:e.jsxs(T,{children:[e.jsxs(I,{children:[e.jsx(_,{children:"Edit Customer"}),e.jsx(U,{children:"Update customer information"})]}),e.jsx($,{children:e.jsxs("form",{onSubmit:G,onKeyDown:L,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-name",children:"Name *"}),e.jsx(d,{id:"edit-name",value:a.name,onChange:s=>l({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(d,{id:"edit-phone",value:a.phone,onChange:s=>l({...a,phone:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-whatsappNumber",children:"WhatsApp Number *"}),e.jsx(d,{id:"edit-whatsappNumber",value:a.whatsappNumber,onChange:s=>l({...a,whatsappNumber:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-email",children:"Email"}),e.jsx(d,{id:"edit-email",type:"email",value:a.email,onChange:s=>l({...a,email:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-address",children:"Address"}),e.jsx(d,{id:"edit-address",value:a.address,onChange:s=>l({...a,address:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(m,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(d,{id:"edit-notes",value:a.notes,onChange:s=>l({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>{g(!1),S(null)},children:"Cancel"}),e.jsx(i,{type:"submit",children:"Update Customer"})]})]})})]})})]}),e.jsx(v,{children:e.jsx(y,{className:"p-6",children:e.jsx("form",{onSubmit:z,className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(K,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(d,{placeholder:"Search by name, phone, WhatsApp, or email...",value:E,onChange:s=>b(s.target.value),onKeyDown:s=>s.key==="Enter"&&z(s),className:"pl-9"})]}),e.jsx(i,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(K,{className:"h-4 w-4"})}),p&&e.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>{C(""),b(""),j(1)},children:"Clear"})]})})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[u.length===0&&!P&&e.jsx(v,{className:"md:col-span-2 lg:col-span-3",children:e.jsxs(y,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:p?"No customers match your search.":"No customers yet. Add your first customer to get started."}),p&&e.jsx(i,{className:"mt-4",variant:"outline",onClick:()=>{C(""),b(""),j(1)},children:"Clear search"})]})}),u.map(s=>{var r,t;return e.jsxs(v,{children:[e.jsx(Y,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(ee,{children:s.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>H(s),title:"WhatsApp",className:"text-[#25D366] hover:text-[#25D366] hover:bg-[#25D366]/10",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>J(s),title:"Edit",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>Z(s._id),title:"Delete",className:"text-destructive hover:text-destructive",children:e.jsx(re,{className:"h-4 w-4"})})]})]})}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-1 text-sm",children:[e.jsx("p",{className:"text-muted-foreground",children:s.phone}),e.jsx("p",{className:"text-muted-foreground",children:s.whatsappNumber}),s.email&&e.jsx("p",{className:"text-muted-foreground",children:s.email}),e.jsxs("div",{className:"pt-2",children:[e.jsx("span",{className:"text-muted-foreground",children:"Cars: "}),e.jsx("span",{className:"font-medium",children:((r=s.stats)==null?void 0:r.cars)||0}),e.jsx("span",{className:"text-muted-foreground ml-4",children:"Jobs: "}),e.jsx("span",{className:"font-medium",children:((t=s.stats)==null?void 0:t.jobs)||0})]})]})})]},s._id)})]}),x.totalPages>1&&e.jsx(v,{children:e.jsx(y,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",u.length===0?0:(h-1)*D+1,"â€“",(h-1)*D+u.length," of ",x.total," customers"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>q(h-1),disabled:h<=1,children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",h," of ",x.totalPages]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>q(h+1),disabled:h>=x.totalPages,children:["Next",e.jsx(ie,{className:"h-4 w-4 ml-1"})]})]})]})})})]})}export{pe as default};
