import{r as u,a as j,u as o,j as e,V as ue,f as m,P as G,p as $,L as i,I as c,g as me,C as b,e as S,b as he,c as xe,d as pe}from"./index-DqxcJu2F.js";import{N as z}from"./number-input-ChyhMXUc.js";import{S as E,a as L,b as H,c as k,d as h}from"./select-DioDUAlB.js";import{D as W,a as _,b as R,c as K,d as Z}from"./dialog-CjVt5OCo.js";import{D as ge,a as je,M as Ne,b as ve,c as F}from"./dropdown-menu-3qC3HvhZ.js";import{B as we}from"./badge-B8JpMQoX.js";import{S as Q}from"./search-Kqcw5TmY.js";import{C as fe,a as Ce}from"./chevron-right-VOtsL3N1.js";const J=12;function Pe(){const[B,X]=u.useState([]),[M,T]=u.useState(!0),[N,P]=u.useState(""),[q,D]=u.useState(""),[g,I]=u.useState("ALL"),[x,v]=u.useState(1),[p,Y]=u.useState({total:0,totalPages:0}),[ee,w]=u.useState(!1),[se,C]=u.useState(!1),[ae,U]=u.useState(null),[a,t]=u.useState({businessName:"",ownerName:"",phone:"",email:"",whatsappNumber:"",address:"",location:"",workingHoursStart:"09:00",workingHoursEnd:"18:00",carHandlingCapacity:"SINGLE",maxConcurrentJobs:1,defaultCurrency:"USD",defaultLanguage:"en",adminEmail:"",adminPassword:""});u.useEffect(()=>{f()},[N,g,x]);const f=async()=>{var s,d;T(!0);try{const n=new URLSearchParams;n.set("page",String(x)),n.set("limit",String(J)),N.trim()&&n.set("search",N.trim()),g!=="ALL"&&n.set("status",g);const r=await j.get(`/super-admin/businesses?${n.toString()}`);r.data.success?(X(r.data.businesses||[]),r.data.pagination&&Y({total:r.data.pagination.total,totalPages:r.data.pagination.totalPages})):o.error("Failed to load businesses")}catch(n){o.error(((d=(s=n.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to load businesses")}finally{T(!1)}},O=s=>{s==null||s.preventDefault(),P(q),v(1)},V=s=>{s<1||s>p.totalPages||v(s)},re=async s=>{var d,n,r;if(s.preventDefault(),a.carHandlingCapacity==="MULTIPLE"){const l=Number(a.maxConcurrentJobs);if(!l||l===0){o.error("Max concurrent jobs must be greater than zero");return}}try{const l={...a,maxConcurrentJobs:a.carHandlingCapacity==="SINGLE"?1:Number(a.maxConcurrentJobs)};l.adminEmail||delete l.adminEmail,l.adminPassword||delete l.adminPassword;const y=await j.post("/super-admin/businesses",l);if(y.data.success){const ce="Business created successfully!",oe=(d=y.data.adminUser)!=null&&d.password?`Admin Email: ${y.data.adminUser.email}
Password: ${y.data.adminUser.password}`:"Business created";o.success(ce,{description:oe,duration:1e4}),w(!1),A(),f()}else o.error("Failed to create business")}catch(l){o.error(((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to create business")}},te=async s=>{var d,n;if(s.preventDefault(),a.carHandlingCapacity==="MULTIPLE"){const r=Number(a.maxConcurrentJobs);if(!r||r===0){o.error("Max concurrent jobs must be greater than zero");return}}try{const r={...a,maxConcurrentJobs:a.carHandlingCapacity==="SINGLE"?1:Number(a.maxConcurrentJobs)};(await j.put(`/super-admin/businesses/${ae._id}`,r)).data.success?(o.success("Business updated successfully!"),C(!1),A(),f()):o.error("Failed to update business")}catch(r){o.error(((n=(d=r.response)==null?void 0:d.data)==null?void 0:n.message)||"Failed to update business")}},ne=async(s,d)=>{var n,r;try{(await j.post(`/super-admin/businesses/${s}/suspend`,{status:d})).data.success?(o.success(`Business ${d==="ACTIVE"?"activated":"suspended"} successfully!`),f()):o.error("Failed to update business status")}catch(l){o.error(((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to update business status")}},ie=async s=>{var d,n;if(confirm("Are you sure you want to delete this business? This will remove the business and its admin user. This action cannot be undone."))try{(await j.delete(`/super-admin/businesses/${s}`)).data.success?(o.success("Business deleted successfully!"),f()):o.error("Failed to delete business")}catch(r){o.error(((n=(d=r.response)==null?void 0:d.data)==null?void 0:n.message)||"Failed to delete business")}},le=async s=>{var d,n;try{const r=await j.post(`/super-admin/businesses/${s}/reset-password`,{});r.data.success?o.success("Password reset successfully!",{description:r.data.newPassword?`New password: ${r.data.newPassword}`:"Password updated"}):o.error("Failed to reset password")}catch(r){o.error(((n=(d=r.response)==null?void 0:d.data)==null?void 0:n.message)||"Failed to reset password")}},A=()=>{t({businessName:"",ownerName:"",phone:"",email:"",whatsappNumber:"",address:"",location:"",workingHoursStart:"09:00",workingHoursEnd:"18:00",carHandlingCapacity:"SINGLE",maxConcurrentJobs:1,defaultCurrency:"USD",defaultLanguage:"en",adminEmail:"",adminPassword:""}),U(null)},de=s=>{U(s),t({businessName:s.businessName,ownerName:s.ownerName,phone:s.phone,email:s.email,whatsappNumber:s.whatsappNumber,address:s.address,location:s.location||"",workingHoursStart:s.workingHoursStart,workingHoursEnd:s.workingHoursEnd,carHandlingCapacity:s.carHandlingCapacity,maxConcurrentJobs:s.maxConcurrentJobs,defaultCurrency:s.defaultCurrency,defaultLanguage:s.defaultLanguage}),C(!0)};return M?e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(ue,{size:"section"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-800",children:"Car Washes"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-0.5",children:"Manage all car wash businesses"})]}),e.jsxs(m,{onClick:()=>{A(),w(!0)},className:"min-h-[44px] gap-2 w-full sm:w-auto",children:[e.jsx(G,{className:"h-4 w-4"}),"Add Business"]})]}),e.jsx(W,{open:ee,onOpenChange:w,children:e.jsxs(_,{className:"w-[calc(100vw-2rem)] max-w-3xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsxs(R,{className:"pb-4",children:[e.jsx(K,{children:"Onboard New Car Wash Business"}),e.jsx(Z,{children:"Complete the onboarding workflow to add a new car wash business"})]}),e.jsxs("form",{onSubmit:re,onKeyDown:$,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Business Information"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"businessName",children:"Business Name *"}),e.jsx(c,{id:"businessName",value:a.businessName,onChange:s=>t({...a,businessName:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"ownerName",children:"Owner Name *"}),e.jsx(c,{id:"ownerName",value:a.ownerName,onChange:s=>t({...a,ownerName:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",children:"Business Email *"}),e.jsx(c,{id:"email",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",children:"Phone *"}),e.jsx(c,{id:"phone",value:a.phone,onChange:s=>t({...a,phone:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"whatsappNumber",children:"WhatsApp Number *"}),e.jsx(c,{id:"whatsappNumber",value:a.whatsappNumber,onChange:s=>t({...a,whatsappNumber:s.target.value}),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"address",children:"Address *"}),e.jsx(c,{id:"address",value:a.address,onChange:s=>t({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"location",children:"Location (Optional)"}),e.jsx(c,{id:"location",value:a.location,onChange:s=>t({...a,location:s.target.value}),placeholder:"City, State, Country"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"workingHoursStart",children:"Working Hours Start *"}),e.jsx(c,{id:"workingHoursStart",type:"time",value:a.workingHoursStart,onChange:s=>t({...a,workingHoursStart:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"workingHoursEnd",children:"Working Hours End *"}),e.jsx(c,{id:"workingHoursEnd",type:"time",value:a.workingHoursEnd,onChange:s=>t({...a,workingHoursEnd:s.target.value}),required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Operational Settings"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"carHandlingCapacity",children:"Car Handling Capacity *"}),e.jsxs(E,{value:a.carHandlingCapacity,onValueChange:s=>t({...a,carHandlingCapacity:s,maxConcurrentJobs:s==="SINGLE"?1:a.maxConcurrentJobs}),children:[e.jsx(L,{children:e.jsx(H,{})}),e.jsxs(k,{children:[e.jsx(h,{value:"SINGLE",children:"Single Car"}),e.jsx(h,{value:"MULTIPLE",children:"Multiple Cars"})]})]})]}),a.carHandlingCapacity==="MULTIPLE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"maxConcurrentJobs",children:"Max Concurrent Jobs *"}),e.jsx(z,{id:"maxConcurrentJobs",value:a.maxConcurrentJobs,onChange:s=>t({...a,maxConcurrentJobs:s}),required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:"Admin User Credentials"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Leave blank to use business email and auto-generate password"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"adminEmail",children:"Admin Email (Optional)"}),e.jsx(c,{id:"adminEmail",type:"email",value:a.adminEmail,onChange:s=>t({...a,adminEmail:s.target.value}),placeholder:"Leave blank to use business email"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"adminPassword",children:"Admin Password (Optional)"}),e.jsx(me,{id:"adminPassword",value:a.adminPassword,onChange:s=>t({...a,adminPassword:s.target.value}),placeholder:"Leave blank to auto-generate",minLength:6})]})]})]}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 pt-4 border-t",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>w(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(m,{type:"submit",className:"w-full sm:w-auto",children:"Onboard Business"})]})]})]})}),e.jsx(b,{children:e.jsx(S,{className:"p-6",children:e.jsxs("form",{onSubmit:O,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(Q,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(c,{placeholder:"Search by name, owner, email...",value:q,onChange:s=>D(s.target.value),onKeyDown:s=>s.key==="Enter"&&O(s),className:"pl-9"})]}),e.jsx(m,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(E,{value:g,onValueChange:s=>{I(s),v(1)},children:[e.jsx(L,{className:"w-[160px]",children:e.jsx(H,{placeholder:"Status"})}),e.jsxs(k,{children:[e.jsx(h,{value:"ALL",children:"All"}),e.jsx(h,{value:"ACTIVE",children:"Active"}),e.jsx(h,{value:"SUSPENDED",children:"Suspended"}),e.jsx(h,{value:"INACTIVE",children:"Inactive"})]})]}),(N||g!=="ALL")&&e.jsx(m,{type:"button",variant:"ghost",size:"sm",onClick:()=>{P(""),D(""),I("ALL"),v(1)},children:"Clear"})]})]})})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[B.map(s=>{var d,n,r;return e.jsxs(b,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(he,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(xe,{className:"text-lg",children:s.businessName}),e.jsx(pe,{children:s.ownerName})]}),e.jsxs(ge,{children:[e.jsx(je,{asChild:!0,children:e.jsx(m,{variant:"ghost",size:"icon",children:e.jsx(Ne,{className:"h-4 w-4"})})}),e.jsxs(ve,{align:"end",children:[e.jsx(F,{onClick:l=>{l.preventDefault(),de(s)},children:"Edit"}),e.jsx(F,{onClick:l=>{l.preventDefault(),le(s._id)},children:"Reset Password"}),e.jsx(F,{onClick:l=>{l.preventDefault(),ne(s._id,s.status==="ACTIVE"?"SUSPENDED":"ACTIVE")},children:s.status==="ACTIVE"?"Suspend":"Activate"}),e.jsx(F,{onClick:l=>{l.preventDefault(),ie(s._id)},className:"text-destructive focus:text-destructive",children:"Delete"})]})]})]})}),e.jsx(S,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Status"}),e.jsx(we,{variant:s.status==="ACTIVE"?"default":"secondary",children:s.status})]}),((d=s.plan)==null?void 0:d.planId)&&e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Plan"}),e.jsx("span",{className:"font-medium",children:s.plan.planId.name})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Jobs"}),e.jsx("span",{className:"font-medium",children:((n=s.stats)==null?void 0:n.jobs)||0})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Customers"}),e.jsx("span",{className:"font-medium",children:((r=s.stats)==null?void 0:r.customers)||0})]})]})})]},s._id)}),B.length===0&&!M&&e.jsx(b,{className:"col-span-full",children:e.jsxs(S,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:"No businesses found"}),N||g!=="ALL"?e.jsx(m,{variant:"outline",className:"mt-4",onClick:()=>{P(""),D(""),I("ALL"),v(1)},children:"Clear filters"}):e.jsxs(m,{className:"mt-4",onClick:()=>w(!0),children:[e.jsx(G,{className:"mr-2 h-4 w-4"}),"Create First Business"]})]})})]}),p.totalPages>1&&e.jsx(b,{children:e.jsx(S,{className:"py-4",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",Math.min((x-1)*J+1,p.total),"â€“",Math.min(x*J,p.total)," of ",p.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>V(x-1),disabled:x<=1,children:[e.jsx(fe,{className:"h-4 w-4"}),"Previous"]}),e.jsxs("span",{className:"text-sm",children:["Page ",x," of ",p.totalPages]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>V(x+1),disabled:x>=p.totalPages,children:["Next",e.jsx(Ce,{className:"h-4 w-4"})]})]})]})})}),e.jsx(W,{open:se,onOpenChange:C,children:e.jsxs(_,{className:"w-[calc(100vw-2rem)] max-w-2xl max-h-[90vh] overflow-y-auto p-4 sm:p-6",children:[e.jsxs(R,{className:"pb-4",children:[e.jsx(K,{children:"Edit Business"}),e.jsx(Z,{children:"Update all business information"})]}),e.jsxs("form",{onSubmit:te,onKeyDown:$,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-businessName",children:"Business Name *"}),e.jsx(c,{id:"edit-businessName",value:a.businessName,onChange:s=>t({...a,businessName:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-ownerName",children:"Owner Name *"}),e.jsx(c,{id:"edit-ownerName",value:a.ownerName,onChange:s=>t({...a,ownerName:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-email",children:"Business Email *"}),e.jsx(c,{id:"edit-email",type:"email",value:a.email,onChange:s=>t({...a,email:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-phone",children:"Phone *"}),e.jsx(c,{id:"edit-phone",value:a.phone,onChange:s=>t({...a,phone:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-whatsappNumber",children:"WhatsApp Number *"}),e.jsx(c,{id:"edit-whatsappNumber",value:a.whatsappNumber,onChange:s=>t({...a,whatsappNumber:s.target.value}),placeholder:"+1234567890",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-address",children:"Address *"}),e.jsx(c,{id:"edit-address",value:a.address,onChange:s=>t({...a,address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-location",children:"Location (Optional)"}),e.jsx(c,{id:"edit-location",value:a.location,onChange:s=>t({...a,location:s.target.value}),placeholder:"City, State, Country"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-workingHoursStart",children:"Working Hours Start *"}),e.jsx(c,{id:"edit-workingHoursStart",type:"time",value:a.workingHoursStart,onChange:s=>t({...a,workingHoursStart:s.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-workingHoursEnd",children:"Working Hours End *"}),e.jsx(c,{id:"edit-workingHoursEnd",type:"time",value:a.workingHoursEnd,onChange:s=>t({...a,workingHoursEnd:s.target.value}),required:!0})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-carHandlingCapacity",children:"Car Handling Capacity *"}),e.jsxs(E,{value:a.carHandlingCapacity,onValueChange:s=>t({...a,carHandlingCapacity:s,maxConcurrentJobs:s==="SINGLE"?1:a.maxConcurrentJobs}),children:[e.jsx(L,{children:e.jsx(H,{})}),e.jsxs(k,{children:[e.jsx(h,{value:"SINGLE",children:"Single Car"}),e.jsx(h,{value:"MULTIPLE",children:"Multiple Cars"})]})]})]}),a.carHandlingCapacity==="MULTIPLE"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-maxConcurrentJobs",children:"Max Concurrent Jobs *"}),e.jsx(z,{id:"edit-maxConcurrentJobs",value:a.maxConcurrentJobs,onChange:s=>t({...a,maxConcurrentJobs:s}),required:!0})]})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-defaultLanguage",children:"Default Language"}),e.jsxs(E,{value:a.defaultLanguage,onValueChange:s=>t({...a,defaultLanguage:s}),children:[e.jsx(L,{children:e.jsx(H,{})}),e.jsxs(k,{children:[e.jsx(h,{value:"en",children:"English"}),e.jsx(h,{value:"es",children:"Spanish"}),e.jsx(h,{value:"ar",children:"Arabic"})]})]})]})}),e.jsxs("div",{className:"flex flex-col-reverse sm:flex-row justify-end gap-2 pt-4 border-t",children:[e.jsx(m,{type:"button",variant:"outline",onClick:()=>C(!1),className:"w-full sm:w-auto",children:"Cancel"}),e.jsx(m,{type:"submit",className:"w-full sm:w-auto",children:"Update Business"})]})]})]})})]})}export{Pe as default};
