import{j as m,V as p}from"./index-DqxcJu2F.js";const f="https://server.vashq.com/api";async function j(e,s=18e4){const o=`${f.replace(/\/$/,"")}/admin/upload/images`,i=typeof localStorage<"u"?localStorage.getItem("token"):null;if(!i)throw new Error("Not authenticated");const l=new AbortController,c=setTimeout(()=>l.abort(),s);try{const r=await fetch(o,{method:"POST",headers:{Authorization:`Bearer ${i}`},body:e,signal:l.signal,credentials:"include"});clearTimeout(c);const t=await r.json().catch(()=>({}));if(!r.ok)throw new Error((t==null?void 0:t.message)||r.statusText||"Upload failed");if(!t.success||!Array.isArray(t.urls))throw new Error((t==null?void 0:t.message)||"Upload failed");return t}catch(r){throw clearTimeout(c),r.name==="AbortError"?new Error("Upload timed out. Please try again."):r.message==="Failed to fetch"?new Error("Upload failed. Check your connection, try again, or use fewer/smaller images."):r}}const w=1280,x=.75,y=100*1024;function U(e,s={}){const o=s.maxDimension??w,i=s.quality??x,l=s.minSizeToCompress??y;return!e||!e.type.startsWith("image/")||e.size<=l?Promise.resolve(e):new Promise(c=>{const r=URL.createObjectURL(e),t=new Image;t.onload=()=>{URL.revokeObjectURL(r);let{width:a,height:n}=t;(a>o||n>o)&&(a>=n?(n=Math.round(n*o/a),a=o):(a=Math.round(a*o/n),n=o));const u=document.createElement("canvas");u.width=a,u.height=n;const d=u.getContext("2d");if(!d){c(e);return}d.drawImage(t,0,0,a,n),u.toBlob(g=>{if(!g){c(e);return}const h=e.name.replace(/\.[^.]+$/i,".jpg");c(new File([g],h,{type:"image/jpeg"}))},"image/jpeg",i)},t.onerror=()=>{URL.revokeObjectURL(r),c(e)},t.src=r})}async function A(e,s={}){const o=Array.from(e||[]),i=[];for(const l of o)i.push(await U(l,s));return i}function E({show:e,message:s="Uploading imagesâ€¦"}){return e?m.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",role:"alert","aria-busy":"true","aria-live":"polite",children:m.jsxs("div",{className:"flex flex-col items-center gap-4 rounded-xl bg-card p-8 shadow-lg border border-border",children:[m.jsx(p,{size:"section"}),m.jsx("p",{className:"text-sm font-medium text-foreground",children:s}),m.jsx("p",{className:"text-xs text-muted-foreground",children:"Please wait, do not close the page."})]})}):null}export{E as U,A as c,j as u};
