import{i as M,r as y,j as r,X as T,f as I,u as w}from"./index-D5eo3nMI.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=M("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=M("ImagePlus",[["path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7",key:"31hg93"}],["line",{x1:"16",x2:"22",y1:"5",y2:"5",key:"ez7e4s"}],["line",{x1:"19",x2:"19",y1:"2",y2:"8",key:"1gkr8c"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),z=1280,F=.75,O=100*1024;function B(e,g={}){const c=g.maxDimension??z,h=g.quality??F,i=g.minSizeToCompress??O;return!e||!e.type.startsWith("image/")||e.size<=i?Promise.resolve(e):new Promise(l=>{const s=URL.createObjectURL(e),a=new Image;a.onload=()=>{URL.revokeObjectURL(s);let{width:m,height:n}=a;(m>c||n>c)&&(m>=n?(n=Math.round(n*c/m),m=c):(m=Math.round(m*c/n),n=c));const d=document.createElement("canvas");d.width=m,d.height=n;const p=d.getContext("2d");if(!p){l(e);return}p.drawImage(a,0,0,m,n),d.toBlob(f=>{if(!f){l(e);return}const j=e.name.replace(/\.[^.]+$/i,".jpg");l(new File([f],j,{type:"image/jpeg"}))},"image/jpeg",h)},a.onerror=()=>{URL.revokeObjectURL(s),l(e)},a.src=s})}const D="https://server.vashq.com/api";async function q(e,g=18e4){const c=`${D.replace(/\/$/,"")}/admin/upload/images`,h=typeof localStorage<"u"?localStorage.getItem("token"):null;if(!h)throw new Error("Not authenticated");const i=new AbortController,l=setTimeout(()=>i.abort(),g);try{const s=await fetch(c,{method:"POST",headers:{Authorization:`Bearer ${h}`},body:e,signal:i.signal,credentials:"include"});clearTimeout(l);const a=await s.json().catch(()=>({}));if(!s.ok)throw new Error((a==null?void 0:a.message)||s.statusText||"Upload failed");if(!a.success||!Array.isArray(a.urls))throw new Error((a==null?void 0:a.message)||"Upload failed");return a}catch(s){throw clearTimeout(l),s.name==="AbortError"?new Error("Upload timed out. Please try again."):s.message==="Failed to fetch"?new Error("Upload failed. Check your connection, try again, or use fewer/smaller images."):s}}const G=2,H=4,U="image/jpeg,image/jpg,image/png,image/gif,image/webp,image/bmp,image/svg+xml,image/tiff,image/x-icon,image/heic,image/avif,image/*";function J({value:e=[],onChange:g,folder:c,minImages:h=G,maxImages:i=H,disabled:l=!1,label:s="Photos",description:a,thumbnailClassName:m="h-20 w-20 object-cover rounded border"}){const n=y.useRef(null),d=y.useRef(null),p=y.useRef(e),[f,j]=y.useState(!1);y.useEffect(()=>{p.current=e},[e]);const v=e.length<i&&!l&&!f,A=async t=>{var u,E,b;if(!((u=t==null?void 0:t.type)!=null&&u.startsWith("image/"))){w.error("Please select an image file");return}if((((E=p.current)==null?void 0:E.length)??0)>=i){w.error(`Maximum ${i} images allowed`);return}j(!0);try{const x=await B(t),k=new FormData;k.append("images",x),c&&k.append("folder",c);const N=await q(k);if((b=N==null?void 0:N.urls)!=null&&b.length){const P=p.current??[];g([...P,N.urls[0]]),w.success("Image added")}else w.error("Upload failed")}catch(x){w.error((x==null?void 0:x.message)||"Image upload failed")}finally{j(!1),n.current&&(n.current.value=""),d.current&&(d.current.value="")}},R=t=>{var u;const o=(u=t.target.files)==null?void 0:u[0];o&&A(o),t.target.value=""},L=t=>{var u;const o=(u=t.target.files)==null?void 0:u[0];o&&A(o),t.target.value=""},S=t=>{g(e.filter((o,u)=>u!==t))},C=a??`Add images one by one from camera or gallery. Minimum ${h}, maximum ${i}.`;return r.jsxs("div",{className:"space-y-3",children:[s&&r.jsx("p",{className:"text-sm font-medium text-foreground",children:s}),C&&r.jsx("p",{className:"text-sm text-muted-foreground",children:C}),r.jsx("input",{ref:n,type:"file",accept:U,capture:"environment",onChange:R,disabled:!v,className:"hidden","aria-hidden":"true"}),r.jsx("input",{ref:d,type:"file",accept:U,onChange:L,disabled:!v,className:"hidden","aria-hidden":"true"}),r.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.map((t,o)=>r.jsxs("div",{className:"relative",children:[r.jsx("img",{src:t,alt:`${s} ${o+1}`,className:m}),!l&&r.jsx("button",{type:"button",onClick:()=>S(o),className:"absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full w-5 h-5 flex items-center justify-center text-xs hover:opacity-90","aria-label":`Remove image ${o+1}`,children:r.jsx(T,{className:"h-3 w-3"})})]},o)),v&&r.jsxs("div",{className:"flex flex-wrap gap-2",children:[r.jsxs(I,{type:"button",variant:"outline",size:"sm",className:"gap-2",onClick:()=>{var t;return(t=n.current)==null?void 0:t.click()},children:[r.jsx(_,{className:"h-4 w-4"}),"Take photo"]}),r.jsxs(I,{type:"button",variant:"outline",size:"sm",className:"gap-2",onClick:()=>{var t;return(t=d.current)==null?void 0:t.click()},children:[r.jsx($,{className:"h-4 w-4"}),"From gallery"]})]})]}),f&&r.jsx("p",{className:"text-sm text-muted-foreground",children:"Uploadingâ€¦"}),e.length>0&&r.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.length," of ",i," images. ",e.length<h&&`Add at least ${h-e.length} more to continue.`]})]})}export{J as M,H as a,G as b};
