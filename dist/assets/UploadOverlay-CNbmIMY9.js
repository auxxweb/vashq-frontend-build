import{j as u,V as f}from"./index-o_2gjTLu.js";const w="https://server.vashq.com/api";async function A(e,o=12e4){const r=`${w.replace(/\/$/,"")}/admin/upload/images`,c=typeof localStorage<"u"?localStorage.getItem("token"):null;if(!c)throw new Error("Not authenticated");const l=new AbortController,i=setTimeout(()=>l.abort(),o);try{const s=await fetch(r,{method:"POST",headers:{Authorization:`Bearer ${c}`},body:e,signal:l.signal,credentials:"include"});clearTimeout(i);const t=await s.json().catch(()=>({}));if(!s.ok)throw new Error((t==null?void 0:t.message)||s.statusText||"Upload failed");if(!t.success||!Array.isArray(t.urls))throw new Error((t==null?void 0:t.message)||"Upload failed");return t}catch(s){throw clearTimeout(i),s.name==="AbortError"?new Error("Upload timed out. Please try again."):s.message==="Failed to fetch"?new Error("Network error. Please check your connection and try again."):s}}const x=1920,y=.85,j=400*1024;function b(e,o={}){const r=o.maxDimension??x,c=o.quality??y,l=o.minSizeToCompress??j;return!e||!e.type.startsWith("image/")||e.size<=l?Promise.resolve(e):new Promise((i,s)=>{const t=URL.createObjectURL(e),m=new Image;m.onload=()=>{URL.revokeObjectURL(t);let{width:a,height:n}=m;(a>r||n>r)&&(a>=n?(n=Math.round(n*r/a),a=r):(a=Math.round(a*r/n),n=r));const d=document.createElement("canvas");d.width=a,d.height=n;const g=d.getContext("2d");if(!g){i(e);return}g.drawImage(m,0,0,a,n),d.toBlob(h=>{if(!h){i(e);return}const p=e.name.replace(/\.[^.]+$/i,".jpg");i(new File([h],p,{type:"image/jpeg"}))},"image/jpeg",c)},m.onerror=()=>{URL.revokeObjectURL(t),i(e)},m.src=t})}async function E(e,o={}){const r=Array.from(e||[]),c=[];for(const l of r)c.push(await b(l,o));return c}function I({show:e,message:o="Uploading imagesâ€¦"}){return e?u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-background/80 backdrop-blur-sm",role:"alert","aria-busy":"true","aria-live":"polite",children:u.jsxs("div",{className:"flex flex-col items-center gap-4 rounded-xl bg-card p-8 shadow-lg border border-border",children:[u.jsx(f,{size:"section"}),u.jsx("p",{className:"text-sm font-medium text-foreground",children:o}),u.jsx("p",{className:"text-xs text-muted-foreground",children:"Please wait, do not close the page."})]})}):null}export{I as U,E as c,A as u};
