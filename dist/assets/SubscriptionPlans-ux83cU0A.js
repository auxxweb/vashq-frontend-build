import{r as c,a as p,u as l,j as e,V as le,f as o,P as ce,C as w,e as D,I as y,b as de,c as oe,d as ue,p as B,L as d}from"./index-o_2gjTLu.js";import{N as S}from"./number-input-BmvmxN0i.js";import{T as U}from"./textarea-ujPTKh4g.js";import{D as _,a as K,b as R,c as Z,d as H}from"./dialog-7kLME1aO.js";import{D as he,a as me,M as xe,b as pe,c as T}from"./dropdown-menu-DVH-FcuU.js";import{S as fe,a as je,b as ge,c as ve,d as L}from"./select-Bb9Oo39L.js";import{B as G}from"./badge-DECccTTd.js";import{f as ye}from"./currencyUtils-CJd_f-r_.js";import{S as J}from"./search-CZ0m3mFL.js";import{T as Ne}from"./trash-2-CO0jrPGd.js";import{C as be,a as Ce}from"./chevron-right-Ds0J_p7o.js";const E=12;function Ie(){const[N,Q]=c.useState([]),[z,I]=c.useState(!0),[x,A]=c.useState(""),[V,F]=c.useState(""),[m,P]=c.useState("ALL"),[u,f]=c.useState(1),[j,W]=c.useState({total:0,totalPages:0}),[X,Y]=c.useState("USD"),[ee,b]=c.useState(!1),[se,C]=c.useState(!1),[q,M]=c.useState(null),[a,n]=c.useState({name:"",description:"",validityDays:30,price:0,features:[""],isActive:!0,isFreeTrial:!1});c.useEffect(()=>{g()},[x,m,u]),c.useEffect(()=>{p.get("/super-admin/settings").then(s=>{var i,t;(i=s.data)!=null&&i.success&&((t=s.data.settings)!=null&&t.defaultCurrency)&&Y(s.data.settings.defaultCurrency)}).catch(()=>{})},[]);const g=async()=>{var s,i;I(!0);try{const t=new URLSearchParams;t.set("page",String(u)),t.set("limit",String(E)),x.trim()&&t.set("search",x.trim()),m!=="ALL"&&t.set("isActive",m==="true");const r=await p.get(`/super-admin/subscription-plans?${t.toString()}`);r.data.success&&(Q(r.data.plans||[]),r.data.pagination&&W({total:r.data.pagination.total,totalPages:r.data.pagination.totalPages}))}catch(t){l.error(((i=(s=t.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to load plans")}finally{I(!1)}},O=s=>{s==null||s.preventDefault(),A(V),f(1)},$=s=>{s<1||s>j.totalPages||f(s)},k=()=>{n({name:"",description:"",validityDays:30,price:0,features:[""],isActive:!0,isFreeTrial:!1}),M(null)},ae=async s=>{var r,h;s.preventDefault();const i=a.features.filter(Boolean),t=Number(a.validityDays);if(!a.name){l.error("Name is required");return}if(!t||t<1){l.error("Validity must be greater than zero");return}try{(await p.post("/super-admin/subscription-plans",{...a,validityDays:t,price:Number(a.price)||0,features:i})).data.success?(l.success("Plan created"),b(!1),k(),g()):l.error("Failed to create plan")}catch(v){l.error(((h=(r=v.response)==null?void 0:r.data)==null?void 0:h.message)||"Failed to create plan")}},te=async s=>{var r,h;if(s.preventDefault(),!q)return;const i=a.features.filter(Boolean),t=Number(a.validityDays);if(!t||t<1){l.error("Validity must be greater than zero");return}try{(await p.put(`/super-admin/subscription-plans/${q._id}`,{...a,validityDays:t,price:Number(a.price)||0,features:i})).data.success?(l.success("Plan updated"),C(!1),k(),g()):l.error("Failed to update plan")}catch(v){l.error(((h=(r=v.response)==null?void 0:r.data)==null?void 0:h.message)||"Failed to update plan")}},ie=async(s,i)=>{var t,r;try{(await p.patch(`/super-admin/subscription-plans/${s._id}/status`,{isActive:i})).data.success&&(l.success(i?"Plan activated":"Plan deactivated"),g())}catch(h){l.error(((r=(t=h.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to update status")}},re=async s=>{var i,t;if(window.confirm(`Delete plan "${s.name}"? This cannot be undone.`))try{const r=await p.delete(`/super-admin/subscription-plans/${s._id}`);r.data.success?(l.success("Plan deleted"),g()):l.error(r.data.message||"Failed to delete plan")}catch(r){l.error(((t=(i=r.response)==null?void 0:i.data)==null?void 0:t.message)||"Failed to delete plan")}},ne=s=>{var i;M(s),n({name:s.name,description:s.description||"",validityDays:s.validityDays||30,price:s.price??0,features:(i=s.features)!=null&&i.length?s.features:[""],isActive:s.isActive!==!1,isFreeTrial:s.isFreeTrial===!0}),C(!0)};return z?e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(le,{size:"section"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold tracking-tight text-slate-800",children:"Subscription Plans"}),e.jsx("p",{className:"text-muted-foreground text-sm mt-0.5",children:"Manual subscription plans (no online payments). Admin approval required for upgrades."})]}),e.jsxs(o,{onClick:()=>{k(),b(!0)},className:"min-h-[44px] gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Add Plan"]})]}),e.jsx(w,{children:e.jsx(D,{className:"p-6",children:e.jsxs("form",{onSubmit:O,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(y,{placeholder:"Search by name or description...",value:V,onChange:s=>F(s.target.value),onKeyDown:s=>s.key==="Enter"&&O(s),className:"pl-9"})]}),e.jsx(o,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(J,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(fe,{value:m,onValueChange:s=>{P(s),f(1)},children:[e.jsx(je,{className:"w-[160px]",children:e.jsx(ge,{placeholder:"Status"})}),e.jsxs(ve,{children:[e.jsx(L,{value:"ALL",children:"All plans"}),e.jsx(L,{value:"true",children:"Active"}),e.jsx(L,{value:"false",children:"Inactive"})]})]}),(x||m!=="ALL")&&e.jsx(o,{type:"button",variant:"ghost",size:"sm",onClick:()=>{A(""),F(""),P("ALL"),f(1)},children:"Clear"})]})]})})}),e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:N.map(s=>{var i;return e.jsxs(w,{className:"transition-shadow duration-150",children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx(oe,{className:"text-lg text-slate-800",children:s.name}),e.jsxs(ue,{children:[s.validityDays," days validity · ",ye(s.price??0,X)]})]}),e.jsxs(he,{children:[e.jsx(me,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",children:e.jsx(xe,{className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsx(T,{onClick:()=>ne(s),children:"Edit"}),e.jsx(T,{onClick:()=>ie(s,!s.isActive),children:s.isActive?"Deactivate":"Activate"}),!s.isActive&&e.jsxs(T,{onClick:()=>re(s),className:"text-destructive focus:text-destructive",children:[e.jsx(Ne,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})}),e.jsxs(D,{className:"space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx(G,{variant:s.isActive?"default":"secondary",children:s.isActive?"Active":"Inactive"}),s.isFreeTrial&&e.jsx(G,{variant:"outline",children:"Free trial"})]}),s.description&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description}),((i=s.features)==null?void 0:i.length)>0&&e.jsxs("ul",{className:"text-sm list-disc list-inside space-y-1",children:[s.features.slice(0,4).map((t,r)=>e.jsx("li",{children:t},r)),s.features.length>4&&e.jsxs("li",{className:"text-muted-foreground",children:["+",s.features.length-4," more"]})]})]})]},s._id)})}),N.length===0&&!z&&e.jsx(w,{children:e.jsxs(D,{className:"p-12 text-center text-muted-foreground",children:[x||m!=="ALL"?"No plans match your search or filter.":"No subscription plans yet. Add a plan to let shops request upgrades.",(x||m!=="ALL")&&e.jsx(o,{className:"mt-4",variant:"outline",onClick:()=>{A(""),F(""),P("ALL"),f(1)},children:"Clear"})]})}),j.totalPages>1&&e.jsx(w,{children:e.jsx(D,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",N.length===0?0:(u-1)*E+1,"–",(u-1)*E+N.length," of ",j.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>$(u-1),disabled:u<=1,children:[e.jsx(be,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",u," of ",j.totalPages]}),e.jsxs(o,{variant:"outline",size:"sm",onClick:()=>$(u+1),disabled:u>=j.totalPages,children:["Next",e.jsx(Ce,{className:"h-4 w-4 ml-1"})]})]})]})})}),e.jsx(_,{open:ee,onOpenChange:b,children:e.jsxs(K,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(Z,{children:"Add Subscription Plan"}),e.jsx(H,{children:"Plans are used for manual upgrades. No payment processing."})]}),e.jsxs("form",{onSubmit:ae,onKeyDown:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Plan name *"}),e.jsx(y,{value:a.name,onChange:s=>n({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Description"}),e.jsx(U,{value:a.description,onChange:s=>n({...a,description:s.target.value}),rows:2})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Validity (days) *"}),e.jsx(S,{value:a.validityDays,onChange:s=>n({...a,validityDays:s}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Price"}),e.jsx(S,{decimal:!0,allowZero:!0,value:a.price,onChange:s=>n({...a,price:s}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Features (one per line)"}),a.features.map((s,i)=>e.jsx(y,{className:"mb-2",value:s,onChange:t=>{const r=[...a.features];r[i]=t.target.value,n({...a,features:r})},placeholder:`Feature ${i+1}`},i)),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>n({...a,features:[...a.features,""]}),children:"+ Add feature"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isActive",checked:a.isActive,onChange:s=>n({...a,isActive:s.target.checked}),className:"h-4 w-4"}),e.jsx(d,{htmlFor:"isActive",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"isFreeTrial",checked:a.isFreeTrial,onChange:s=>n({...a,isFreeTrial:s.target.checked}),className:"h-4 w-4"}),e.jsx(d,{htmlFor:"isFreeTrial",children:"Free trial (one-time per shop; disabled for life after upgrade)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(o,{type:"submit",children:"Create Plan"})]})]})]})}),e.jsx(_,{open:se,onOpenChange:C,children:e.jsxs(K,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(R,{children:[e.jsx(Z,{children:"Edit Plan"}),e.jsx(H,{children:"Update plan details."})]}),e.jsxs("form",{onSubmit:te,onKeyDown:B,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Plan name *"}),e.jsx(y,{value:a.name,onChange:s=>n({...a,name:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Description"}),e.jsx(U,{value:a.description,onChange:s=>n({...a,description:s.target.value}),rows:2})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Validity (days) *"}),e.jsx(S,{value:a.validityDays,onChange:s=>n({...a,validityDays:s}),required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Price"}),e.jsx(S,{decimal:!0,allowZero:!0,value:a.price,onChange:s=>n({...a,price:s}),placeholder:"0"})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Features"}),a.features.map((s,i)=>e.jsx(y,{className:"mb-2",value:s,onChange:t=>{const r=[...a.features];r[i]=t.target.value,n({...a,features:r})}},i)),e.jsx(o,{type:"button",variant:"outline",size:"sm",onClick:()=>n({...a,features:[...a.features,""]}),children:"+ Add feature"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"editActive",checked:a.isActive,onChange:s=>n({...a,isActive:s.target.checked}),className:"h-4 w-4"}),e.jsx(d,{htmlFor:"editActive",children:"Active"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"editFreeTrial",checked:a.isFreeTrial,onChange:s=>n({...a,isFreeTrial:s.target.checked}),className:"h-4 w-4"}),e.jsx(d,{htmlFor:"editFreeTrial",children:"Free trial (one-time per shop; disabled for life after upgrade)"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{type:"button",variant:"outline",onClick:()=>C(!1),children:"Cancel"}),e.jsx(o,{type:"submit",children:"Update Plan"})]})]})]})})]})}export{Ie as default};
