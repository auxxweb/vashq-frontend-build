import{r as c,a as g,u as o,j as e,V as le,f as i,P as ne,C as b,e as y,I as m,p as $,L as d,b as ce,c as oe}from"./index-BW20lZeO.js";import{D as K,a as M,b as R,c as H,d as G,f as Z}from"./dialog-DFhCNs-i.js";import{S as P,a as k,b as E,c as _,d as S}from"./select-rIuRCf4V.js";import{S as J}from"./search-BGL9Yz2T.js";import{P as ie}from"./pen-square-nzxuhg1F.js";import{T as de}from"./trash-2-DvsyZgvr.js";import{C as me,a as ue}from"./chevron-right-C5NbmIo2.js";const z=12;function Ne(){const[f,Q]=c.useState([]),[w,W]=c.useState([]),[q,O]=c.useState(!0),[x,F]=c.useState(""),[T,L]=c.useState(""),[h,D]=c.useState("ALL"),[u,j]=c.useState(1),[p,X]=c.useState({total:0,totalPages:0}),[Y,v]=c.useState(!1),[ee,N]=c.useState(!1),[V,I]=c.useState(null),[a,l]=c.useState({customerId:"",carNumber:"",brand:"",model:"",color:"",notes:""});c.useEffect(()=>{C()},[x,h,u]),c.useEffect(()=>{g.get("/admin/customers?limit=500").then(s=>{var r;(r=s.data)!=null&&r.success&&W(s.data.customers||[])}).catch(()=>{})},[]);const C=async()=>{var s,r;O(!0);try{const t=new URLSearchParams;t.set("page",String(u)),t.set("limit",String(z)),x.trim()&&t.set("search",x.trim()),h&&h!=="ALL"&&t.set("customerId",h);const n=await g.get(`/admin/cars?${t.toString()}`);n.data.success?(Q(n.data.cars||[]),n.data.pagination&&X({total:n.data.pagination.total,totalPages:n.data.pagination.totalPages})):o.error("Failed to load cars")}catch(t){o.error(((r=(s=t.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to load cars")}finally{O(!1)}},B=s=>{s==null||s.preventDefault(),F(T),j(1)},U=s=>{s<1||s>p.totalPages||j(s)},se=async s=>{var r,t;if(s.preventDefault(),!a.customerId||!a.carNumber){o.error("Please select a customer and enter car number");return}try{(await g.post("/admin/cars",a)).data.success?(o.success("Car added successfully!"),v(!1),A(),C()):o.error("Failed to add car")}catch(n){o.error(((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to add car")}},ae=async s=>{var r,t;if(s.preventDefault(),!!V)try{(await g.put(`/admin/cars/${V._id}`,a)).data.success?(o.success("Car updated successfully!"),N(!1),I(null),A(),C()):o.error("Failed to update car")}catch(n){o.error(((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to update car")}},re=s=>{var r;I(s),l({customerId:((r=s.customerId)==null?void 0:r._id)||s.customerId||"",carNumber:s.carNumber,brand:s.brand||"",model:s.model||"",color:s.color||"",notes:s.notes||""}),N(!0)},te=async s=>{var r,t;if(confirm("Are you sure you want to delete this car?"))try{(await g.delete(`/admin/cars/${s}`)).data.success?(o.success("Car deleted successfully!"),C()):o.error("Failed to delete car")}catch(n){o.error(((t=(r=n.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to delete car")}},A=()=>{l({customerId:"",carNumber:"",brand:"",model:"",color:"",notes:""})};return q?e.jsx("div",{className:"flex justify-center items-center w-full",children:e.jsx(le,{size:"section"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Cars"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage customer cars"})]}),e.jsxs(i,{onClick:()=>{A(),v(!0)},children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Add Car"]})]}),e.jsx(b,{children:e.jsx(y,{className:"p-6",children:e.jsxs("form",{onSubmit:B,className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-2 min-w-0",children:[e.jsxs("div",{className:"relative flex-1 min-w-0",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(m,{placeholder:"Search by car number, brand, model, color, or customer...",value:T,onChange:s=>L(s.target.value),onKeyDown:s=>s.key==="Enter"&&B(s),className:"pl-9"})]}),e.jsx(i,{type:"submit",variant:"secondary",size:"icon",className:"shrink-0 h-10 w-10",title:"Search",children:e.jsx(J,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs(P,{value:h,onValueChange:s=>{D(s),j(1)},children:[e.jsx(k,{className:"w-[200px]",children:e.jsx(E,{placeholder:"All customers"})}),e.jsxs(_,{children:[e.jsx(S,{value:"ALL",children:"All customers"}),w.map(s=>e.jsxs(S,{value:s._id,children:[s.name," – ",s.phone]},s._id))]})]}),(x||h!=="ALL")&&e.jsx(i,{type:"button",variant:"ghost",size:"sm",onClick:()=>{F(""),L(""),D("ALL"),j(1)},children:"Clear"})]})]})})}),e.jsx(K,{open:Y,onOpenChange:v,children:e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(H,{children:"Add New Car"}),e.jsx(G,{children:"Add a car for a customer"})]}),e.jsx(Z,{children:e.jsxs("form",{onSubmit:se,onKeyDown:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Customer *"}),e.jsxs(P,{value:a.customerId,onValueChange:s=>l({...a,customerId:s}),required:!0,children:[e.jsx(k,{children:e.jsx(E,{placeholder:"Select customer"})}),e.jsx(_,{children:w.map(s=>e.jsxs(S,{value:s._id,children:[s.name," - ",s.phone]},s._id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"carNumber",children:"Car Number *"}),e.jsx(m,{id:"carNumber",value:a.carNumber,onChange:s=>l({...a,carNumber:s.target.value}),placeholder:"e.g. ABC-1234",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"brand",children:"Brand"}),e.jsx(m,{id:"brand",value:a.brand,onChange:s=>l({...a,brand:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"model",children:"Model"}),e.jsx(m,{id:"model",value:a.model,onChange:s=>l({...a,model:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"color",children:"Color"}),e.jsx(m,{id:"color",value:a.color,onChange:s=>l({...a,color:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"notes",children:"Notes"}),e.jsx(m,{id:"notes",value:a.notes,onChange:s=>l({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>v(!1),children:"Cancel"}),e.jsx(i,{type:"submit",children:"Add Car"})]})]})})]})}),e.jsx(K,{open:ee,onOpenChange:N,children:e.jsxs(M,{children:[e.jsxs(R,{children:[e.jsx(H,{children:"Edit Car"}),e.jsx(G,{children:"Update car details"})]}),e.jsx(Z,{children:e.jsxs("form",{onSubmit:ae,onKeyDown:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Customer *"}),e.jsxs(P,{value:a.customerId,onValueChange:s=>l({...a,customerId:s}),required:!0,children:[e.jsx(k,{children:e.jsx(E,{placeholder:"Select customer"})}),e.jsx(_,{children:w.map(s=>e.jsxs(S,{value:s._id,children:[s.name," - ",s.phone]},s._id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-carNumber",children:"Car Number *"}),e.jsx(m,{id:"edit-carNumber",value:a.carNumber,onChange:s=>l({...a,carNumber:s.target.value}),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-brand",children:"Brand"}),e.jsx(m,{id:"edit-brand",value:a.brand,onChange:s=>l({...a,brand:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-model",children:"Model"}),e.jsx(m,{id:"edit-model",value:a.model,onChange:s=>l({...a,model:s.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-color",children:"Color"}),e.jsx(m,{id:"edit-color",value:a.color,onChange:s=>l({...a,color:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"edit-notes",children:"Notes"}),e.jsx(m,{id:"edit-notes",value:a.notes,onChange:s=>l({...a,notes:s.target.value})})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{type:"button",variant:"outline",onClick:()=>{N(!1),I(null)},children:"Cancel"}),e.jsx(i,{type:"submit",children:"Update Car"})]})]})})]})}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[f.length===0&&!q&&e.jsx(b,{className:"md:col-span-2 lg:col-span-3",children:e.jsxs(y,{className:"p-12 text-center",children:[e.jsx("p",{className:"text-muted-foreground",children:x||h!=="ALL"?"No cars match your search or filter.":"No cars yet. Add your first car to get started."}),(x||h!=="ALL")&&e.jsx(i,{className:"mt-4",variant:"outline",onClick:()=>{F(""),L(""),D("ALL"),j(1)},children:"Clear"})]})}),f.map(s=>{var r;return e.jsxs(b,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsx(oe,{children:s.carNumber}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>re(s),children:e.jsx(ie,{className:"h-4 w-4"})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:()=>te(s._id),children:e.jsx(de,{className:"h-4 w-4"})})]})]})}),e.jsxs(y,{children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:[s.brand," ",s.model," ",s.color&&`• ${s.color}`]}),s.customerId&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Customer: ",typeof s.customerId=="object"?(r=s.customerId)==null?void 0:r.name:"-"]})]})]},s._id)})]}),p.totalPages>1&&e.jsx(b,{children:e.jsx(y,{className:"py-4",children:e.jsxs("div",{className:"flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",f.length===0?0:(u-1)*z+1,"–",(u-1)*z+f.length," of ",p.total]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>U(u-1),disabled:u<=1,children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Previous"]}),e.jsxs("span",{className:"text-sm px-2",children:["Page ",u," of ",p.totalPages]}),e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>U(u+1),disabled:u>=p.totalPages,children:["Next",e.jsx(ue,{className:"h-4 w-4 ml-1"})]})]})]})})})]})}export{Ne as default};
